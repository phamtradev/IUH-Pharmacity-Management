name: Continuous Integration - Build & Test

on:
  # Chạy khi có Pull Request vào main
  pull_request:
    branches: [ main ]

  # Chạy khi code đã được merge vào main (để verify lại)
  push:
    branches: [ main ]

jobs:
  build-and-test:
    name: Build and Test Java Application
    runs-on: ubuntu-latest

    steps:
      # Checkout source code
      - name: Checkout source code
        uses: actions/checkout@v4

      # Setup Java 21
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21

      # Cache Maven dependencies
      - name: Cache Maven dependencies
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            maven-${{ runner.os }}-

      # Install local dependency (if exists)
      - name: Install local Swing Toast Notifications library
        run: |
          if [ -f library/swing-toast-notifications-1.0.4.jar ]; then
            mvn install:install-file \
              -Dfile=library/swing-toast-notifications-1.0.4.jar \
              -DgroupId=raven.toast \
              -DartifactId=swing-toast-notifications \
              -Dversion=1.0.3 \
              -Dpackaging=jar
          else
            echo "Local library not found, skipping installation"
          fi

      # Build and run tests
      - name: Build and run tests
        run: mvn -B verify
