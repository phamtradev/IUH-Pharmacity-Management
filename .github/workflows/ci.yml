name: CI Build

on:
  push:
    branches: ["**"]
  pull_request:
  workflow_dispatch:

jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: "17"
          distribution: "temurin"

      - name: Cache Maven repository
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            maven-${{ runner.os }}-

      - name: Install local toast jar versions 1.0.2 and 1.0.3 (if present)
        run: |
          if [ -f library/swing-toast-notifications-1.0.4.jar ]; then
            echo "Installing local swing-toast-notifications as 1.0.2, 1.0.3 (from 1.0.4 jar)"
            mvn -q install:install-file \
              -Dfile=library/swing-toast-notifications-1.0.4.jar \
              -DgroupId=raven.toast \
              -DartifactId=swing-toast-notifications \
              -Dversion=1.0.3 \
              -Dpackaging=jar
            mvn -q install:install-file \
              -Dfile=library/swing-toast-notifications-1.0.4.jar \
              -DgroupId=raven.toast \
              -DartifactId=swing-toast-notifications \
              -Dversion=1.0.2 \
              -Dpackaging=jar
          else
            echo "WARNING: library/swing-toast-notifications-1.0.4.jar not found; skipping local install"
          fi

      - name: Build & Test
        run: mvn -B verify

